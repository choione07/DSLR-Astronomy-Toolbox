# DSLR 망원경 천문학 툴박스

Canon CR3 원본 파일부터 전문적인 측광 분석까지, DSLR 망원경 촬영을 위한 완전한 Python 기반 천문 이미지 처리 파이프라인입니다.

## 개요

이 툴박스는 DSLR 카메라로 촬영한 망원경 이미지를 처리하기 위한 포괄적인 워크플로우를 제공합니다:
- **변환**: Canon CR3 원본 파일을 FITS 형식으로 변환
- **보정**: 바이어스/다크/플랫 보정으로 이미지 보정
- **분석**: 개구측광을 통한 별 밝기 분석
- **시각화**: 출판 품질의 플롯으로 결과 시각화

변광성 연구, 외계행성 통과 측광, 천문학 연구에 최적화되어 있습니다.

## 빠른 시작

### 설치

1. **Python 의존성 설치:**
   ```bash
   pip install astropy photutils matplotlib numpy scipy rawpy
   ```

2. **애플리케이션 실행:**
   ```bash
   python main.py
   ```

### 기본 워크플로우

1. **원본 이미지 변환** → `convert.py`를 실행하여 CR3 파일을 FITS로 변환
2. **이미지 보정** → `calibration_gui.py`로 바이어스/다크/플랫 보정 수행
3. **측광 수행** → `photometry.py`로 별 추적 및 측정 실행

## 주요 기능

- **완전한 워크플로우**: CR3 → FITS → 보정 → 측광
- **사용자 친화적 GUI**: 모든 처리 단계를 위한 직관적인 인터페이스
- **RGB 및 흑백 지원**: 컬러 및 흑백 이미지 모두 처리
- **자동 별 추적**: 이미지 시퀀스 전체에서 중심점 기반 추적
- **수동 순차 모드**: 정밀한 제어를 위한 프레임별 분석
- **전문 측광**: 이상치 제거를 위한 시그마 클리핑 하늘 배경 추정
- **정확한 노이즈 계산**: 원본 광자 수로부터 물리적으로 정확한 푸아송 노이즈
- **표준 CCD 보정**: 모범 사례를 따르는 플랫 프레임의 적절한 바이어스/다크 보정
- **고급 다크 최적화**: 강건한 통계 방법을 사용한 개선된 다크 프레임 스케일링
- **데이터 시각화**: 광도 곡선, 색상 분석 및 품질 메트릭을 포함한 종합 분석
- **과학적 출력**: 분석 소프트웨어와 호환되는 CSV 내보내기

## 최근 개선 사항 (v1.1)

**중요 알고리즘 수정:**
- ✓ RGB 측광에서 시그마 클리핑 통계 사용 수정 (우주선 및 핫픽셀에 강건함)
- ✓ 푸아송 노이즈 계산 수정하여 원본 카운트 사용 (물리적으로 정확한 불확실성 추정)
- ✓ 중앙값 기반 강건한 통계를 사용한 다크 프레임 최적화 개선
- ✓ 플랫 프레임에서 바이어스/다크를 적절히 빼도록 플랫 필드 보정 수정 (표준 CCD 절차)

이러한 수정은 측광 정확도를 크게 향상시키며 전문 천문 보정 표준을 따릅니다.

## 시스템 요구사항

- **Python**: 3.8+ (tkinter 지원 포함)
- **운영체제**: Windows, macOS 또는 Linux
- **메모리**: 4GB+ RAM 권장
- **디스플레이**: 최소 1400×900 해상도

## 의존성

| 패키지 | 버전 | 용도 |
|---------|---------|---------|
| `astropy` | ≥ 5.0 | FITS 파일 처리, 천문 계산 |
| `photutils` | ≥ 1.5.0 | 개구측광, 별 검출 |
| `matplotlib` | ≥ 3.5.0 | 시각화, GUI 통합 |
| `numpy` | ≥ 1.21 | 배열 연산, 수학 함수 |
| `scipy` | ≥ 1.7 | 통계 함수, 이미지 처리 |
| `rawpy` | 최신 | Canon CR3 원본 파일 처리 |

## 사용 가이드

### 1. 이미지 변환
Canon CR3 파일을 FITS 형식으로 변환:
```bash
python convert.py
```
- CR3 파일이 있는 입력 폴더 선택
- 출력 형식 선택 (RGB FITS 또는 흑백 FITS)
- 전체 디렉토리 자동 처리

### 2. 이미지 보정
바이어스, 다크, 플랫 필드 보정 적용:
```bash
python calibration_gui.py
```
- 보정 프레임 로드 (바이어스, 다크, 플랫)
- 중앙값 스태킹으로 마스터 프레임 생성
- 라이트 프레임에 보정 적용
- 보정된 FITS 파일 출력

### 3. 개구측광
전문적인 정확도로 별의 밝기 측정:
```bash
python photometry.py
```

**기본 단계:**
1. 보정된 FITS 파일이 있는 폴더 선택
2. 식별을 위한 별 이름 입력
3. 첫 번째 이미지에서 대상 별 클릭
4. 슬라이더를 사용하여 개구 반지름 조정:
   - **별 개구**: 별 플럭스를 위한 내부 원 (일반적으로 3-8 픽셀)
   - **내부 하늘**: 배경 환형의 시작 (일반적으로 12-20 픽셀)
   - **외부 하늘**: 배경 환형의 끝 (일반적으로 20-30 픽셀)
5. 처리 모드 선택:
   - **자동**: 시퀀스 전체에서 별을 자동으로 추적
   - **수동 순차**: 각 프레임에서 별 위치 클릭
6. 측광 분석 시작
7. CSV 파일로 결과 저장

### 4. 데이터 분석
종합 분석 보기:
- **광도 곡선**: 시간에 따른 밝기 변화
- **RGB 분석**: 다중 채널 색상 측광
- **품질 메트릭**: 배경 안정성 및 노이즈 분석
- **추적 분석**: 위치 이동 및 이동 품질

## 출력 데이터

결과는 `./results/` 디렉토리에 CSV 파일로 저장되며 다음을 포함합니다:
- **위치 데이터**: x, y 좌표 및 추적 정보
- **측광**: 원본 플럭스, 하늘 보정 플럭스, 배경 수준
- **불확실성**: 푸아송 노이즈 및 하늘 표준편차
- **메타데이터**: FITS 헤더, 타임스탬프, 처리 매개변수

RGB 이미지의 경우, 빨강, 녹색, 파랑 및 흑백 채널에 대한 별도 측정이 제공됩니다.

## 과학적 응용

- **변광성 연구**: 세페이드, RR Lyrae 등의 밝기 변화 모니터링
- **외계행성 측광**: 행성 통과 감지 및 광도 곡선 측정
- **소행성 연구**: 자전 주기 및 밝기 변화 결정
- **색상 측광**: 다중 채널 별 색상 분석
- **교육 프로젝트**: 대학 천문학 실습 및 학생 연구

## 문제 해결

| 문제 | 해결책 |
|-------|----------|
| "별이 감지되지 않음" | 감도 슬라이더를 낮은 값(0.5σ-1.0σ)으로 조정 |
| "추적 손실" | 개구 크기 줄이거나 수동 모드로 전환 |
| "가져오기 오류" | pip로 누락된 의존성 설치 |
| "메모리 문제" | 더 작은 배치의 이미지 처리 |

## 문서

- **README_KR.md** (이 파일): 빠른 시작 가이드 및 기본 사용법
- **DOCUMENTATION_KR.md**: 완전한 기술 문서
- **README.md**: 영문 버전
- **DOCUMENTATION.md**: 영문 기술 문서
- **requirements.txt**: 정확한 의존성 버전

## 기여

이 툴박스는 국제 표준을 따르는 전문 천문학 방법론을 구현합니다. 시스템은 아마추어 천문학자와 연구 응용 프로그램 모두를 위해 설계되었습니다.

자세한 기술 정보, 알고리즘 설명 및 고급 사용법은 [DOCUMENTATION_KR.md](DOCUMENTATION_KR.md)를 참조하세요.

## 라이선스

교육 및 연구 용도를 위한 오픈 소스 천문학 소프트웨어입니다.

---

*원본 이미지부터 과학적 결과까지 - DSLR 망원경 측광을 위한 완전한 솔루션*
